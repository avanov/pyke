<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>Plans and Automatic Program Generation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../stylesheets/pyke.css" type="text/css" />
</head>
<body id="the-whole-page">
  <table id="page-table">
    <thead class="head">
        <tr id="header1"><th id="header" colspan="3">
            PyKE : Python Knowledge Engine
        </th></tr>
        <tr id="header2">
          <th id="crumb-left"></th>
          <th id="crumb-line">
            <div id="nav">
              <ul>
                  <li><a href="../../index.html">Home</a></li>
<li>&gt;</li>
<li><a href="../index.html">Overview</a></li>
<li>&gt;</li>
<li><a href="index.html">Knowledge Bases</a></li>
<li>&gt;</li>
<li>Plans</li>

              </ul>
            </div>
          </th>
          <th id="crumb-right"></th>
        </tr>
    </thead>
    <tbody id="body">
        <tr id="body-tr">
          <td id="left-nav">
            <div id="left-nav-div">
              
<div class="title-nav"><a href="../../index.html">Home</a></div><div class="nav-branch">

<div class="title-nav"><a href="../index.html">Overview</a></div><div class="nav-branch">

<div class="title-nav"><a href="index.html">Knowledge Bases</a></div><div class="nav-branch">
<div class="normal-nav"><a href="fact_bases.html">Fact Bases</a></div>
<div class="normal-nav"><a href="rules.html">Rules</a></div>
<div class="normal-nav"><a href="backward_chaining.html">Backward Chaining</a></div>
<div class="normal-nav"><a href="forward_chaining.html">Forward Chaining</a></div>
<div class="normal-nav"><a href="rule_bases.html">Rule Bases</a></div>
<div class="normal-nav"><a href="plans.html">Plans</a></div>
</div>
</div>
<div class="normal-nav"><a href="../../rule_base_syntax/index.html">Rule Base Syntax</a></div>
<div class="normal-nav"><a href="../../interfacing_to_pyke/index.html">Interfacing to Pyke</a></div>
<div class="normal-nav"><a href="../../pyke_internals/index.html">Internals</a></div>
</div>

            </div>
            <div id="icons">
                Hosted by: <br />
                <!-- <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=3" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a> -->
                <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=4" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
            </div>
          </td>
          <td id="main-td">
            <div id="main>
                <a name="startcontent" id="startcontent"></a>
                <div class="document" id="plans-and-automatic-program-generation">
<h1 class="title">Plans and Automatic Program Generation</h1>
<p>Once you understand how backward-chaining works, it is relatively easy to
do automatic program generation.</p>
<p>The way this is done is by attaching python functions to the
backward-chaining rules.  These functions are written at the end of each
rule in the .krb file.  They don't affect how the rules run, but are
gathered up to form a call graph that is returned along with the pattern
variable bindings that prove the top-level goal.</p>
<p>Consider a small rule base to construct programs to transfer money between
bank accounts.  Each <em>from_acct</em> and <em>to_acct</em> takes one of two forms:</p>
<ol class="arabic simple">
<li>(name, account_type)
- This is a local account with this bank.
- Example: ('bruce', 'checking').</li>
<li>(bank, name, account_type)
- This is a foreign account with another bank.
- Example: ('my_other_bank', 'bruce', 'checking').</li>
</ol>
<p>At least one of the bank accounts must be a local account.</p>
<p>Here's the example rule base:</p>
<pre class="literal-block">
 1  transfer1:
 2      use transfer($from_acct, $to_acct) taking (amount)
 3      when
 4          withdraw($from_acct)
 5              $$(amount)
 6          deposit($to_acct)
 7              $$(amount)

 8  transfer2:
 9      use transfer($from_acct, $to_acct) taking (amount)
10      when
11          transfer_ach($from_acct, $to_acct)
12              $$(amount)

13  withdraw:
14      use withdraw(($who, $acct_type)) taking (amount)
15      with
16          print &quot;withdraw&quot;, amount, &quot;from&quot;, $who, $acct_type

17  deposit:
18      use deposit(($who, $acct_type)) taking (amount)
19      with
20          print &quot;deposit&quot;, amount, &quot;to&quot;, $who, $acct_type

21  transfer_ach1:
22      use transfer_ach($from_acct, ($bank, $who, $acct_type)) taking (amount)
23      when
24          withdraw($from_acct)
25              $$(amount)
26          deposit((central_accts, ach_send_acct))
27              $$(amount)
28      with
29          print &quot;send&quot;, amount, &quot;to bank&quot;, $bank, &quot;acct&quot;, $who, $acct_type

30  transfer_ach2:
31      use transfer_ach($from_acct, $to_acct) taking (amount)
32      when
33          get_ach($from_acct)
34              $$(amount)
35          withdraw((central_accts, ach_recv_acct))
36              $$(amount)
37          deposit($to_acct)
38              $$(amount)

39  get_ach:
40      use get_ach(($bank, $who, $acct_type)) taking (amount)
41      with
42          print &quot;get&quot;, amount, &quot;from bank&quot;, $bank, &quot;acct&quot;, $who, $acct_type
</pre>
<p>The plan is created as a byproduct of proving the goal:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import pyke
&gt;&gt;&gt; pyke.load('examples')
&gt;&gt;&gt; pyke.activate('plan_example')
&gt;&gt;&gt; no_vars, plan1 = pyke.prove_1('plan_example', 'transfer',
...                               (('bruce', 'checking'),
...                                ('bruce', 'savings')),
...                               0)
</pre>
</blockquote>
<p><tt class="docutils literal"><span class="pre">plan1</span></tt> is now a program to transfer X amount
from 'bruce', 'checking' to 'bruce', 'savings'.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; plan1(100)
withdraw 100 from bruce checking
deposit 100 to bruce savings
</pre>
</blockquote>
<p>The program may be used multiple times:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; plan1(50)
withdraw 50 from bruce checking
deposit 50 to bruce savings
</pre>
</blockquote>
<p>Let's create another program:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; no_vars, plan2 = pyke.prove_1('plan_example', 'transfer',
...                               (('my_other_bank', 'bruce', 'checking'),
...                                ('bruce', 'savings')),
...                               0)
</pre>
</blockquote>
<p><tt class="docutils literal"><span class="pre">plan2</span></tt> is now a program to transfer X amount
from 'my_other_bank', 'bruce', 'checking' to 'bruce', 'savings'.</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; plan2(150)
get 150 from bank my_other_bank acct bruce checking
withdraw 150 from central_accts ach_recv_acct
deposit 150 to bruce savings
</pre>
<pre class="doctest-block">
&gt;&gt;&gt; no_vars, plan3 = pyke.prove_1('plan_example', 'transfer',
...                               (('bruce', 'checking'),
...                                ('my_other_bank', 'bruce', 'savings')),
...                               0)
&gt;&gt;&gt; plan3(200)
withdraw 200 from bruce checking
deposit 200 to central_accts ach_send_acct
send 200 to bank my_other_bank acct bruce savings
</pre>
</blockquote>
</div>

            </div>
          </td>
          <td id="right-nav">
            <div id="right-nav-div">
                <h3>Pages</h3>
<ul><li><a href="fact_bases.html">Fact Bases</a><p>Explanation of fact bases and facts.</p>
</li>
<li><a href="rules.html">Rules</a><p>Explanation of rules.</p>
</li>
<li><a href="backward_chaining.html">Backward Chaining</a><p>Explanation of backward-chaining rules.</p>
</li>
<li><a href="forward_chaining.html">Forward Chaining</a><p>Explanation of forward-chaining rules.</p>
</li>
<li><a href="rule_bases.html">Rule Bases</a><p>Explanation of rule bases, overview of .krb files and how these files
are of compiled and loaded into your python program.</p>
</li>
<li><a href="plans.html">Plans and Automatic Program Generation</a><p>Explanation of plans and automatic program generation.</p>
</li></ul>

            </div>
          </td>
        </tr>
    </tbody>
    <tfoot id="foot">
        <tr id="foot1">
          <td id="final-left"></td>
          <td id="final-stuff">
            <div id="end">
                <div id="return-to-top"><a href="#startcontent">Return to Top</a></div>
                <div id="last-modified"><small>Page last modified Wed Oct 31 16:09:38 2007.</small></div>
            </div>
          </td>
          <td id="final-right"></td>
        </tr>
        <tr id="foot2">
          <td id="final-left"></td>
          <td id="copyright">
            Copyright &copy; 2007 Bruce Frederiksen
          </td>
          <td id="final-right"></td>
        </tr>
    </tfoot>
  </table>
</body>
</html>
