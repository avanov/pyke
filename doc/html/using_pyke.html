<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>Using Pyke</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="stylesheets/pyke.css" type="text/css" />
</head>
<body>
  <table id="page-table">
    <thead class="head">
        <tr id="header1"><th id="header" colspan="3">
            &nbsp;
        </th></tr>
        <tr id="header2">
          <th id="crumb-left"></th>
          <th id="crumb-line">
            <div id="nav">
              <ul>
                  <li><a href="index.html">Home</a></li>
<li>&gt;</li>
<li>Using Pyke</li>

              </ul>
            </div>
          </th>
          <th id="crumb-right"></th>
        </tr>
    </thead>

    <tbody id="body">
        <tr id="body-tr">
          <td id="left-nav">
            <div id="left-nav-div">
              
<div class="title-nav"><a href="index.html">Home</a></div><div class="nav-branch">
<div class="normal-nav"><a href="overview/index.html">Overview</a></div>
<div class="normal-nav"><a href="installing_pyke.html">Installing Pyke</a></div>
<div class="normal-nav"><a href="using_pyke.html">Using Pyke</a></div>
<div class="normal-nav"><a href="krb_syntax/index.html">KRB Syntax</a></div>
</div>

            </div>
            <div id="icons">
                <div id="project-page">
                  <a href="http://sourceforge.net/projects/pyke/">Pyke Project Page</a>
                </div>
                Please Make a Donation:<br />
                <a href="http://sourceforge.net/donate/index.php?group_id=207724">
                  <img src="http://images.sourceforge.net/images/project-support.jpg"
                       width="88" height="32" border="0"
                       alt="Support This Project" /> </a> <br /><br />
                Hosted by: <br />
                <!-- <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=3" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a> -->
                <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=4" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
            </div>
          </td>
          <td id="main-td">
            <div id="main">
                <a name="startcontent" id="startcontent"></a>
                <div class="document" id="using-pyke">
<h1 class="title">Using Pyke</h1>
<p>There isn't that much to using pyke.  Generally, all the functions you need
are provided directly by the <tt class="docutils literal"><span class="pre">pyke</span></tt> package:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import pyke
</pre>
</blockquote>
<div class="section">
<h1><a id="initializing-pyke" name="initializing-pyke">Initializing Pyke</a></h1>
<p>There are two functions to initialize pyke:</p>
<dl class="docutils">
<dt>load(paths = ('.',), load_fc = True, load_bc = True)</dt>
<dd>The <tt class="docutils literal"><span class="pre">load</span></tt> function may only be called once.  It expects either a single
directory or a sequence directories.  It recursively walks each directory
looking for <a class="reference" href="krb_syntax/index.html">.krb files</a>.  Each <a class="reference" href="krb_syntax/index.html">.krb file</a> that it finds is compiled,
if out of date, and then the resulting python modules imported.
This causes all of the <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a> to be loaded.</dd>
<dt>add_universal_fact(kb_name, fact_name, args)</dt>
<dd>The <tt class="docutils literal"><span class="pre">add_universal_fact</span></tt> function is called once per <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">fact</a>.  These <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">facts</a>
are never deleted and apply to all <em>cases</em>.</dd>
</dl>
</div>
<div class="section">
<h1><a id="setting-up-each-case" name="setting-up-each-case">Setting up Each Case</a></h1>
<p>Pyke is designed to be run multiple times for multiple <em>cases</em>.  In
general each case has its own set of starting <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">facts</a> and may use different
<a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a>, depending on the situation.</p>
<p>Three functions initialize each case:</p>
<dl class="docutils">
<dt>reset()</dt>
<dd>The <tt class="docutils literal"><span class="pre">reset</span></tt> function is called once to delete all of the <a class="reference" href="overview/knowledge_bases/fact_bases.html#case-specific-facts">case specific
facts</a> from the last run.  It also deactivates all <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a>.</dd>
<dt>assert_(kb_name, fact_name, args)</dt>
<dd>Call <tt class="docutils literal"><span class="pre">assert_</span></tt> (or the equivalent, <tt class="docutils literal"><span class="pre">add_case_specific_fact</span></tt>,
see <a class="reference" href="#other-functions">Other Functions</a>, below) for each starting <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">fact</a> for this case.</dd>
<dt>activate(*rb_names)</dt>
<dd>Then call <tt class="docutils literal"><span class="pre">activate</span></tt> to activate the appropriate <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a>.  This
may be called more than once, if desired, or it can simply take multiple
arguments.</dd>
</dl>
<p>Pyke is now ready to prove goals for this case!</p>
</div>
<div class="section">
<h1><a id="proving-goals" name="proving-goals">Proving Goals</a></h1>
<p>Two functions are provided that cover the easy cases.  More general
functions are provided in <a class="reference" href="#other-functions">Other Functions</a>, below.</p>
<dl class="docutils">
<dt>prove_1(kb_name, entity_name, fixed_args, num_returns)</dt>
<dd>Returns the first proof as two results: a tuple whose length == num_returns
containing the returned values, and a <a class="reference" href="overview/plans.html">plan</a>.  The <a class="reference" href="overview/plans.html">plan</a> is None if no <a class="reference" href="overview/plans.html">plan</a>
was generated.  Raises pyke.CanNotProve if no proof is found.</dd>
<dt>prove_n(kb_name, entity_name, fixed_args, num_returns)</dt>
<dd>This is a generator yielding two results: a tuple whose length == num_returns,
and a <a class="reference" href="overview/plans.html">plan</a>, for each possible proof.  Like <tt class="docutils literal"><span class="pre">prove_1</span></tt>, the <a class="reference" href="overview/plans.html">plan</a> is None
if no <a class="reference" href="overview/plans.html">plan</a> was generated.</dd>
</dl>
<div class="section">
<h2><a id="running-and-pickling-plans" name="running-and-pickling-plans">Running and Pickling Plans</a></h2>
<p>Once you've obtained a <a class="reference" href="overview/plans.html">plan</a> from <tt class="docutils literal"><span class="pre">prove_1</span></tt> or <tt class="docutils literal"><span class="pre">prove_n</span></tt>, you just call
it like a normal python function.  The arguments required are simply those
specified, if any, in the <a class="reference" href="krb_syntax/bc_rule.html#taking-clause">taking clause</a> of the <a class="reference" href="overview/rules/index.html">rule</a> proving the top-level
goal.</p>
<p>You may call the <a class="reference" href="overview/plans.html">plan</a> function any number of times.  You may even pickle
the <a class="reference" href="overview/plans.html">plan</a> for later use.  But the <a class="reference" href="overview/plans.html">plans</a> are constructed out of
<a class="reference" href="http://docs.python.org/lib/module-functools.html">functools.partial</a> functions, so you need to register this with <a class="reference" href="http://docs.python.org/lib/module-copyreg.html">copy_reg</a>
before pickling the <a class="reference" href="overview/plans.html">plan</a>:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; import copy_reg
&gt;&gt;&gt; import functools
&gt;&gt;&gt; copy_reg.pickle(functools.partial,
...                 lambda p: (functools.partial, (p.func,) + p.args))
</pre>
</blockquote>
<p>The program that unpickles the <a class="reference" href="overview/plans.html">plan</a> does not have to import any pyke
modules to be able to run the <a class="reference" href="overview/plans.html">plans</a>.  Just unpickle and call it.</p>
</div>
</div>
<div class="section">
<h1><a id="other-functions" name="other-functions">Other Functions</a></h1>
<p>There are a few more functions that may be useful in special situations.</p>
<p>The first two of these provide more general access to the <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">fact</a> lookup and
goal proof mechanisms.  The catch is that you must first convert <strong>all</strong>
arguments into <a class="reference" href="krb_syntax/pattern.html">patterns</a> and create a <em>context</em> for these <a class="reference" href="krb_syntax/pattern.html">patterns</a>.  This is
discussed <a class="reference" href="#creating-your-own-patterns">below</a>.</p>
<dl class="docutils">
<dt>lookup(kb_name, entity_name, pattern_context, patterns)</dt>
<dd>This is a generator that binds <a class="reference" href="krb_syntax/pattern.html">patterns</a> to successive <a class="reference" href="overview/knowledge_bases/fact_bases.html#facts">facts</a>.  Yields None
for each successful match.</dd>
<dt>prove(kb_name, entity_name, pattern_context, patterns)</dt>
<dd>A generator that binds <a class="reference" href="krb_syntax/pattern.html">patterns</a> to successive proofs.  Yields a
<em>prototype_plan</em> or None for each successful match.  To turn the
prototype_plan into a python function, call create_plan() on it.
This returns the <a class="reference" href="overview/plans.html">plan</a> function.</dd>
</dl>
<p>The remaining functions are:</p>
<dl class="docutils">
<dt>add_case_specific_fact(kb_name, fact_name, args)</dt>
<dd>This is an alternate to the <tt class="docutils literal"><span class="pre">assert_</span></tt> function.</dd>
<dt>get_kb(kb_name)</dt>
<dd>Finds and returns the <a class="reference" href="overview/knowledge_bases/index.html">knowledge base</a> by the name <tt class="docutils literal"><span class="pre">kb_name</span></tt>.  Raises
KeyError if not found.  Note that for <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a>, this returns the
active <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule base</a> where <tt class="docutils literal"><span class="pre">kb_name</span></tt> is the <a class="reference" href="overview/knowledge_bases/rule_bases.html#rule-base-categories">rule base category</a> name.
Thus, not all <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule bases</a> are accessible through this call.</dd>
<dt>get_rb(rb_name)</dt>
<dd>Finds and returns the <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule base</a> by the name <tt class="docutils literal"><span class="pre">rb_name</span></tt>.  Raises
KeyError if not found.  This works for any <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule base</a>, whether it is
active or not.</dd>
<dt>init()</dt>
<dd>This is called once automatically for you by the <tt class="docutils literal"><span class="pre">load</span></tt> function.
You shouldn't have to call it yourself.  If you don't have any <a class="reference" href="overview/knowledge_bases/rule_bases.html">rule
bases</a> this isn't necessary anyway.</dd>
</dl>
<div class="section">
<h2><a id="creating-your-own-patterns" name="creating-your-own-patterns">Creating Your Own Patterns</a></h2>
<p>You'll need two more pyke modules to create your own <a class="reference" href="krb_syntax/pattern.html">patterns</a> and contexts:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from pyke import pattern, contexts
</pre>
</blockquote>
<p>There are four kinds of <a class="reference" href="krb_syntax/pattern.html">patterns</a>:</p>
<dl class="docutils">
<dt>pattern.pattern_literal(data)</dt>
<dd>This matches the <tt class="docutils literal"><span class="pre">data</span></tt> provided.</dd>
<dt>pattern.pattern_tuple((elements), rest_var = None)</dt>
<dd>This matches a tuple.  <tt class="docutils literal"><span class="pre">Elements</span></tt> must each be a pattern and must
match the first <em>n</em> elements of the tuple.  <tt class="docutils literal"><span class="pre">Rest_var</span></tt> must be a
variable (or anonymous).  It will match the rest of the tuple and is
always bound to a (possibly empty) tuple.</dd>
<dt>contexts.variable(name)</dt>
<dd>This will match anything the first time it is encountered.  But then
must match the first value each additional time it is encountered.
Calling the constructor twice with the same name produces the same
variable and must match the same value in all of the places that it is
used.</dd>
<dt>contexts.anonymous()</dt>
<dd>This will match anything each time it is encountered.
Calling the constructor many times is not a problem.</dd>
</dl>
<p>Finally, to create a <em>pattern context</em>, you need:</p>
<pre class="literal-block">
contexts.simple_context()
</pre>
<p>You'll need to save this context to lookup your variable values after each
proof is yielded. This is done by either:</p>
<pre class="literal-block">
some_context.lookup_data(variable_name)
some_variable.as_data(some_context)
</pre>
</div>
</div>
</div>

                <!-- <div id="return-to-top">
                       <a href="#">Return to Top</a>
                     </div>
                -->
            </div>
          </td>
          <td id="right-nav">
            <div id="right-nav-div">
                <h3>More:</h3>
<div class="right-item"><a href="overview/index.html">Overview</a><p>The big picture of
what all this knowledge-base, inferencing and automatic program
generation stuff means and how it works.</p>
</div>
<div class="right-item"><a href="installing_pyke.html">Installing Pyke</a><p>System Requirements and installing pyke.</p>
</div>
<div class="right-item"><a href="using_pyke.html">Using Pyke</a><p>How your python program uses pyke.</p>
</div>
<div class="right-item"><a href="krb_syntax/index.html">KRB Syntax</a><p>Syntax of the knowledge rule base (KRB) files, which is where you
write your rules.</p>
</div>

            </div>
          </td>
        </tr>
    </tbody>

    <tfoot id="foot">
        <tr id="foot2">
          <td id="copyright" colspan="3">
            Copyright &copy; 2007 Bruce Frederiksen
          </td>
        </tr>
    </tfoot>
  </table>

  <div id="last-modified">
    Page last modified Thu, Nov 08 2007.
  </div>

</body>
</html>
