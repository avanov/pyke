<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>Backward Chaining</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../stylesheets/pyke.css" type="text/css" />
</head>
<body>
  <table id="page-table">
    <thead class="head">
        <tr id="header1"><th id="header" colspan="3">
            &nbsp;
        </th></tr>
        <tr id="header2">
          <th id="crumb-left"></th>
          <th id="crumb-line">
            <div id="nav">
              <ul>
                  <li><a href="../../index.html">Home</a></li>
<li>&gt;</li>
<li><a href="../index.html">Logic Programming</a></li>
<li>&gt;</li>
<li><a href="index.html">Rules</a></li>
<li>&gt;</li>
<li>Backward Chaining</li>

              </ul>
            </div>
          </th>
          <th id="crumb-right"></th>
        </tr>
    </thead>

    <tbody id="body">
        <tr id="body-tr">
          <td id="left-nav">
            <div id="left-nav-div">
              
<div class="title-nav"><a href="../../index.html">Home</a></div><div class="nav-branch">
<div class="normal-nav"><a href="../../about_pyke/index.html">About Pyke</a></div>

<div class="title-nav"><a href="../index.html">Logic Programming</a></div><div class="nav-branch">
<div class="normal-nav"><a href="../statements.html">Statements</a></div>
<div class="normal-nav"><a href="../pattern_matching/index.html">Pattern Matching</a></div>

<div class="title-nav"><a href="index.html">Rules</a></div><div class="nav-branch">
<div class="normal-nav"><a href="forward_chaining.html">Forward Chaining</a></div>
<div class="normal-nav"><a href="backward_chaining.html">Backward Chaining</a></div>
</div>
<div class="normal-nav"><a href="../plans.html">Plans</a></div>
</div>
<div class="normal-nav"><a href="../../knowledge_bases/index.html">Knowledge Bases</a></div>
<div class="normal-nav"><a href="../../pyke_syntax/index.html">Pyke Syntax</a></div>
<div class="normal-nav"><a href="../../using_pyke.html">Using Pyke</a></div>
<div class="normal-nav"><a href="../../examples.html">Examples</a></div>
<div class="normal-nav"><a href="../../PyCon2008-paper.html">PyCon 2008 Paper</a></div>
</div>

            </div>
            <div id="icons">
                <div id="project-page">
                  <a href="http://sourceforge.net/projects/pyke/">Pyke Project Page</a>
                </div>
                Please Make a Donation:<br />
                <a href="http://sourceforge.net/donate/index.php?group_id=207724">
                  <img src="http://images.sourceforge.net/images/project-support.jpg"
                       width="88" height="32" border="0"
                       alt="Support This Project" /> </a> <br /><br />
                Hosted by: <br />
                <!-- <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=3" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a> -->
                <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=4" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
            </div>
          </td>
          <td id="main-td">
            <div id="main">
                <a name="startcontent" id="startcontent"></a>
                <div class="document" id="backward-chaining">
<h1 class="title">Backward Chaining</h1>
<p>Backward chaining <a class="reference" href="index.html">rules</a> are processed when your program asks Pyke a <a class="reference" href="FIX">question</a>
(i.e., asks Pyke to <a class="reference" href="../../using_pyke.html#proving-goals">prove</a> a specific <em>goal</em>).  Pyke will only use <a class="reference" href="../../using_pyke.html#setting-up-each-case">activated</a>
<a class="reference" href="../../knowledge_bases/rule_bases.html">rule bases</a> to do the proof.</p>
<div class="section">
<h2><a id="overview-of-backward-chaining" name="overview-of-backward-chaining">Overview of &quot;Backward-Chaining&quot;</a></h2>
<p>To do backward-chaining, Pyke finds rules whose <em>then</em> part matches the <em>goal</em>
(i.e., the question).  Once it finds such a rule, it tries to (recursively)
prove all of the subgoals in the <em>if</em> part of that rule.  Some of these
subgoals are matched against facts, and others are subgoals for other
backward-chaining rules.  If all of the subgoals can be proven, the rule
succeeds and the original goal is proven.  Otherwise, the rule fails, and Pyke
tries to find another rule whose <em>then</em> part matches the goal, and so on.</p>
<p>So Pyke ends up linking (or <em>chaining</em>) the <em>if</em> part of the first rule to the
<em>then</em> part of the next rule.</p>
<p>Reviewing:</p>
<ol class="arabic simple">
<li>Pyke starts by finding a rule whose <em>then</em> part matches the goal.</li>
<li>Pyke then proceeds to process the <em>if</em> part of that rule.</li>
<li>Which may link (or chain) to the <em>then</em> part of another rule.</li>
</ol>
<p>Since Pyke processes these rules from <em>then</em> to <em>if</em> to <em>then</em> to <em>if</em> in the
reverse manner that we normally think of using rules, it's called <em>backward</em>
chaining.</p>
<p>To make this more clear, Pyke has you write your backward-chaining rules
upside down by writing the <em>then</em> part first (since that's how it is
processed).</p>
</div>
<div class="section">
<h2><a id="use-when-rather-than-then-if" name="use-when-rather-than-then-if">&quot;Use&quot;, &quot;When&quot; Rather than &quot;Then&quot;, &quot;If&quot;</a></h2>
<p>But <em>then-if</em> rules sound confusing, so Pyke uses the words <strong>use</strong> and
<strong>when</strong> rather than <strong>then</strong> and <strong>if</strong>.  You can then read the rule as &quot;use&quot;
this statement &quot;when&quot; these other statements can be proven.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike <a class="reference" href="forward_chaining.html">forward-chaining</a> rules, Pyke only allows one statement in the
<em>use</em> clause.</p>
</div>
</div>
<div class="section">
<h2><a id="example" name="example">Example</a></h2>
<p>Consider this example:</p>
<pre class="literal-block">
 1  son_father
 2      use child_parent($son, $father, (), son, father)
 3      when
 4          family.son_of($son, $father, $_)

 5  son_mother
 6      use child_parent($son, $mother, (), son, mother)
 7      when
 8          family.son_of($son, $_, $mother)

 9  daughter_father
10      use child_parent($daughter, $father, (), daughter, father)
11      when
12          family.daughter_of($daughter, $father, $_)

13  daughter_mother
14      use child_parent($daughter, $mother, (), daughter, mother)
15      when
16          family.daughter_of($daughter, $_, $mother)

17  grand_parent_and_child
18      use child_parent($grand_child, $grand_parent, (grand),
19                       $grand_child_type, $grand_parent_type)
20      when
21          child_parent($grand_child, $parent, (), $grand_child_type, $_)
22          child_parent($parent, $grand_parent, (), $_, $grand_parent_type)

23  great_grand_parent_and_child
24      use child_parent($gg_child, $gg_parent, (great, $prefix1, *$rest_prefixes),
25                       $gg_child_type, $gg_parent_type)
26      when
27          child_parent($gg_child, $parent, (), $gg_child_type, $_)
28          child_parent($parent, $gg_parent, ($prefix1, *$rest_prefixes),
29                       $_, $gg_parent_type)
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">These <a class="reference" href="index.html">rules</a> draw the same conclusions as the <a class="reference" href="forward_chaining.html">forward-chaining</a> <a class="reference" href="forward_chaining.html#example">example</a>.</p>
</div>
</div>
<div class="section">
<h2><a id="how-backward-chaining-rules-are-run" name="how-backward-chaining-rules-are-run">How Backward-Chaining Rules are Run</a></h2>
<p>These <a class="reference" href="index.html">rules</a> are not used until you ask Pyke to <a class="reference" href="../../using_pyke.html#proving-goals">prove</a> a goal.</p>
<p>The easiest way to do this is with <em>some_engine.prove_1</em> or
<em>some_engine.prove_n</em>.  <a class="reference" href="../../using_pyke.html#proving-goals">Prove_1</a> only returns the first proof found and
then stops (or raises <tt class="docutils literal"><span class="pre">pyke.knowledge_engine.CanNotProve</span></tt>).  <a class="reference" href="../../using_pyke.html#proving-goals">Prove_n</a>
is a generator that generates all possible proofs (which, in some cases,
might be infinite).  In both cases, you pass a tuple of data arguments and
the number of variable arguments as the last two parameters.  The total number
of arguments for the goal is the sum of the length of the data arguments
that you pass plus the number of variable arguments that you specify.</p>
<p>Both functions return the variable bindings for the number of variable
arguments you specified as a tuple, along with the <a class="reference" href="../plans.html">plan</a>.</p>
</div>
<div class="section">
<h2><a id="running-the-example" name="running-the-example">Running the Example</a></h2>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; from pyke import knowledge_engine
&gt;&gt;&gt; engine = knowledge_engine.engine('examples')
&gt;&gt;&gt; engine.assert_('family', 'son_of', ('michael', 'bruce', 'marilyn'))
&gt;&gt;&gt; engine.assert_('family', 'son_of', ('bruce', 'thomas', 'norma'))
&gt;&gt;&gt; engine.assert_('family', 'daughter_of', ('norma', 'allen', 'ismay'))
&gt;&gt;&gt; engine.activate('bc_example')
</pre>
</blockquote>
<p>Noting happens this time when we activate the rule base, because there are no
forward-chaining rules here.</p>
<p>We want to ask the question: &quot;What is Michael's ancestry?&quot;.  This translates
into the Pyke statement:
<tt class="docutils literal"><span class="pre">bc_example.child_parent(michael,</span> <span class="pre">$v1,</span> <span class="pre">$v2,</span> <span class="pre">$v3,</span> <span class="pre">$v4)</span></tt>.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Note that we're using the name of the rule base, <tt class="docutils literal"><span class="pre">bc_example</span></tt> rather than
the fact base, <tt class="docutils literal"><span class="pre">family</span></tt> here.  We expect this answer to come from the
<tt class="docutils literal"><span class="pre">bc_example</span></tt> rule base.</p>
</div>
<p>This is 'bc_example', 'child_parent', with ('michael',) followed by 4 pattern
variables as arguments:</p>
<blockquote>
<pre class="doctest-block">
&gt;&gt;&gt; for vars, no_plan in engine.prove_n('bc_example', 'child_parent',
...                                     ('michael',), 4):
...     print vars
('bruce', (), 'son', 'father')
('marilyn', (), 'son', 'mother')
('thomas', ('grand',), 'son', 'father')
('norma', ('grand',), 'son', 'mother')
('allen', ('great', 'grand'), 'son', 'father')
('ismay', ('great', 'grand'), 'son', 'mother')
</pre>
</blockquote>
<p>We get six answers.  Each answer is a tuple of the final 4 pattern variables.
So the six proofs found were:</p>
<pre class="literal-block">
bc_example.child_parent(michael, bruce, (), son, father)
bc_example.child_parent(michael, marilyn, (), son, mother)
bc_example.child_parent(michael, thomas, (grand), son, father)
bc_example.child_parent(michael, norma, (grand), son, mother)
bc_example.child_parent(michael, allen, (great, grand), son, father)
bc_example.child_parent(michael, ismay, (great, grand), son, mother)
</pre>
</div>
</div>

                <!-- <div id="return-to-top">
                       <a href="#">Return to Top</a>
                     </div>
                -->
            </div>
          </td>
          <td id="right-nav">
            <div id="right-nav-div">
                <h3>More:</h3>
<div class="right-item"><a href="forward_chaining.html">Forward Chaining</a><p>Explanation of <em>forward-chaining rules</em> and how <em>forward-chaining</em>
works.</p>
</div>
<div class="right-item"><a href="backward_chaining.html">Backward Chaining</a><p>Explanation of <em>backward-chaining</em> rules, including how
<em>backward-chaining</em> and <em>backtracking</em> works.</p>
</div>

            </div>
          </td>
        </tr>
    </tbody>

    <tfoot id="foot">
        <tr id="foot2">
          <td id="copyright" colspan="3">
            Copyright &copy; 2007 Bruce Frederiksen
          </td>
        </tr>
    </tfoot>
  </table>

  <div id="last-modified">
    Page last modified Fri, Aug 15 2008.
  </div>

</body>
</html>
