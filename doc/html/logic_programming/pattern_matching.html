<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>Pattern Matching</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../stylesheets/pyke.css" type="text/css" />
</head>
<body>
  <table id="page-table">
    <thead class="head">
        <tr id="header1"><th id="header" colspan="3">
            &nbsp;
        </th></tr>
        <tr id="header2">
          <th id="crumb-left"></th>
          <th id="crumb-line">
            <div id="nav">
              <ul>
                  <li><a href="../index.html">Home</a></li>
<li>&gt;</li>
<li><a href="index.html">Logic Programming</a></li>
<li>&gt;</li>
<li>Pattern Matching</li>

              </ul>
            </div>
          </th>
          <th id="crumb-right"></th>
        </tr>
    </thead>

    <tbody id="body">
        <tr id="body-tr">
          <td id="left-nav">
            <div id="left-nav-div">
              
<div class="title-nav"><a href="../index.html">Home</a></div><div class="nav-branch">
<div class="normal-nav"><a href="../why_pyke.html">Why Pyke?</a></div>
<div class="normal-nav"><a href="../steps_to_using_pyke.html">Steps to Using Pyke</a></div>
<div class="normal-nav"><a href="../installing_pyke.html">Installing Pyke</a></div>

<div class="title-nav"><a href="index.html">Logic Programming</a></div><div class="nav-branch">
<div class="normal-nav"><a href="statements.html">Statements</a></div>
<div class="normal-nav"><a href="pattern_matching.html">Pattern Matching</a></div>
<div class="normal-nav"><a href="rules/index.html">Rules</a></div>
</div>
<div class="normal-nav"><a href="../knowledge_bases/index.html">Knowledge Bases</a></div>
<div class="normal-nav"><a href="../pyke_syntax/index.html">Pyke Syntax</a></div>
<div class="normal-nav"><a href="../using_pyke.html">Using Pyke</a></div>
<div class="normal-nav"><a href="../examples.html">Examples</a></div>
<div class="normal-nav"><a href="../PyCon2008-paper.html">PyCon 2008 Paper</a></div>
</div>

            </div>
            <div id="icons">
                <div id="project-page">
                  <a href="http://sourceforge.net/projects/pyke/">Pyke Project Page</a>
                </div>
                Please Make a Donation:<br />
                <a href="http://sourceforge.net/donate/index.php?group_id=207724">
                  <img src="http://images.sourceforge.net/images/project-support.jpg"
                       width="88" height="32" border="0"
                       alt="Support This Project" /> </a> <br /><br />
                Hosted by: <br />
                <!-- <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=3" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a> -->
                <a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=207724&amp;type=4" width="125" height="37" border="0" alt="SourceForge.net Logo" /></a>
            </div>
          </td>
          <td id="main-td">
            <div id="main">
                <a name="startcontent" id="startcontent"></a>
                <div class="document" id="pattern-matching">
<h1 class="title">Pattern Matching</h1>
<p>Pattern matching is a little strange at first, so we're going to ease into
it slowly...</p>
<p>There are two aspects to pattern matching: <em>patterns</em>, which you write, and
<em>matching</em>, which is what Pyke does with your patterns.</p>
<p>In a nutshell, patterns are made up of two fundamental building blocks:</p>
<ol class="arabic simple">
<li><a class="reference" href="#literal-patterns">Literal patterns</a>.<ul>
<li>Theses are just data values that only match themselves.</li>
</ul>
</li>
<li><a class="reference" href="#pattern-variables">Pattern variables</a>.<ul>
<li>These will match anything.  (Including other pattern variables, as we'll
see later)!</li>
</ul>
</li>
</ol>
<p>And one compound pattern:</p>
<ul class="simple">
<li><a class="reference" href="#tuple-patterns">Tuple patterns</a>.<ul>
<li>These match, you guessed it!, tuples!</li>
</ul>
</li>
</ul>
<p>We'll examine all of the above looking at how Pyke matches a pattern to data.
Then we'll expand this to cover <a class="reference" href="#matching-two-patterns-together">matching two patterns together</a>.</p>
<p>And finally, a <a class="reference" href="#pathological-question">pathological question</a> to see if you've been paying
attention.</p>
<p>Sound like fun?  Good!  Let's get started!</p>
<p>OK, so why do we need patterns?  The simple answer is that we need patterns
to generalize <a class="reference" href="FIX">statements</a>.  One example is to turn statements into questions.</p>
<div class="important">
<p class="first admonition-title">Important</p>
<ul class="last simple">
<li>When you want a <em>direct</em> statement, such as to state a fact, you just use
<em>data</em> for its arguments.</li>
<li>But when you want a <em>generalized</em> statement, such as to ask a question,
you use <em>patterns</em> for its arguments.</li>
</ul>
</div>
<div class="section">
<h2><a id="literal-patterns" name="literal-patterns">Literal Patterns</a></h2>
<p>You want to ask Pyke a question.  The simplest questions are just asking &quot;Is
statement X true?&quot;.  Going back to Pyke's <a class="reference" href="FIX">family_relations</a> example, your
Python program might want to know whether it's really true that Bruce's
parents are Thomas and Norma?  So it would ask whether the following statement
is true:</p>
<pre class="literal-block">
family.son_of(Bruce, Thomas, Norma)
</pre>
<p>Pyke would search the facts that's it's been told about and answer &quot;thumbs up&quot;
because you've told it before that this statement is true and it has
remembered that.</p>
<p>In this case, all of the statement's arguments are <em>literal patterns</em>.  You
might consider literal patterns to be <em>input</em> to Pyke.  You're passing Bruce,
Thomas and Norma <em>into</em> Pyke.  And Pyke just answers &quot;thumbs up&quot; or &quot;thumbs
down&quot;.</p>
<p>Literal patterns look exactly like data.  Thus, your question would look
exactly like you see above.</p>
</div>
<div class="section">
<h2><a id="pattern-variables" name="pattern-variables">Pattern Variables</a></h2>
<p>To take this to the next level, you might want to ask &quot;Who are the sons of
Thomas and Norma?&quot;.  In this case, you are passing <tt class="docutils literal"><span class="pre">Thomas</span></tt> and <tt class="docutils literal"><span class="pre">Norma</span></tt>
<em>into</em> Pyke, and you'd like Pyke to pass something back <em>out</em> to you as part of
the answer (in addition to the thumbs up).</p>
<p>Pattern variables serve as output parameters.  They start with a <tt class="docutils literal"><span class="pre">$</span></tt>:</p>
<pre class="literal-block">
family.son_of($son, Thomas, Norma)
</pre>
<p>You can use whatever name you like after the <tt class="docutils literal"><span class="pre">$</span></tt>.  Pyke will answer with a
thumbs up <em>binding</em> <tt class="docutils literal"><span class="pre">$son</span></tt> to <tt class="docutils literal"><span class="pre">Bruce</span></tt>.  If you don't like that answer, you
can reject that answer and ask Pyke for another answer (&quot;nope, try again!&quot;).
Each time Pyke finds another son for Thomas and Norma, it answers with another
thumbs up and <tt class="docutils literal"><span class="pre">$son</span></tt> <em>bound</em> to a different value.</p>
<p>If you reject the last son of <tt class="docutils literal"><span class="pre">Thomas</span></tt> and <tt class="docutils literal"><span class="pre">Norma</span></tt> (or if <tt class="docutils literal"><span class="pre">Thomas</span></tt> and
<tt class="docutils literal"><span class="pre">Norma</span></tt> have no sons in the first place), Pyke will answer with a thumbs
down.</p>
<p>We say that Pyke <em>binds</em> <tt class="docutils literal"><span class="pre">Bruce</span></tt> to the pattern variable <tt class="docutils literal"><span class="pre">$son</span></tt> when it
comes back with its first thumbs up.  When we tell Pyke &quot;nope, try again!&quot;,
Pyke must first <em>unbind</em> <tt class="docutils literal"><span class="pre">$son</span></tt> before it can go on and <em>bind</em> it to the
next value.  The &quot;nope&quot; part does the <em>unbinding</em>, and the &quot;try again&quot; part
does the <em>binding</em> again to a new value.</p>
<p>So at any point in time, a pattern variable is either <em>bound</em> to a value or
<em>unbound</em>.  If we follow a particular pattern variable through time, we might
see that it is alternately bound and unbound many times as Pyke tries to find
a suitable answer to your question.  Specifically, when Pyke comes back with
the final thumbs down, <tt class="docutils literal"><span class="pre">$son</span></tt> is unbound.</p>
<div class="section">
<h3><a id="anonymous-pattern-variables" name="anonymous-pattern-variables">Anonymous Pattern Variables</a></h3>
<p>Suppose we want to know who Norma's sons are?  In this case we don't care
about the father.  We use <em>anonymous variables</em> as &quot;don't care&quot; placeholders.</p>
<p>An anonymous variable is any pattern variable who's name starts with an
underscore (<tt class="docutils literal"><span class="pre">_</span></tt>).  The rest of the name doesn't matter and just serves as
documentation (and so <tt class="docutils literal"><span class="pre">$_</span></tt> is all that's strictly needed).</p>
<p>So &quot;Who are Norma's sons?&quot; looks like:</p>
<pre class="literal-block">
family.son_of($son, $_father, Norma)
</pre>
<p>We're giving Norma as input to Pyke, and asking for the <tt class="docutils literal"><span class="pre">$son</span></tt> as output and
telling Pyke that we don't care about the <tt class="docutils literal"><span class="pre">$_father</span></tt>.</p>
<p>Anonymous variables are never bound to values.  (So you could say that they
are always unbound).</p>
</div>
<div class="section">
<h3><a id="pattern-variable-identity" name="pattern-variable-identity">Pattern Variable Identity</a></h3>
<p>Now this is very important, so pay attention!  The same pattern variable
<em>name</em> means the same <em>pattern variable</em>.  Thus, if you say <tt class="docutils literal"><span class="pre">$son</span></tt> twice,
it's the <em>same</em> pattern variable.  And, a pattern variable can only be bound
to one value (at a time), so you mean the <em>same</em> data value must appear in
both places.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">This does <em>not</em> apply to <a class="reference" href="#anonymous-pattern-variables">anonymous pattern variables</a>.  Since they are
never bound to a value, each use of the same anonymous variable can match
different data values.</p>
</div>
<p>So if you wanted to see all of the sons with the same name as their fathers,
you would ask:</p>
<pre class="literal-block">
family.son_of($father, $father, $_mother)
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p>The Pyke <a class="reference" href="FIX">family_relations</a> example never uses the same name for both
father and son because that would cause confusion about which of them
was the father to both of their sons and daughters.</p>
<p>In these cases, it modifies the name of the son to make it unique.</p>
<p class="last">Thus, this question would always fail within the family_relations
example...</p>
</div>
<p>And so here is the complete explanation of how pattern variables are matched
to a data value.</p>
<p>First, the pattern variable is checked to see if it is already bound to a
value.</p>
<p>If it is bound to a value, then this bound value has to match the data for
the match to succeed.</p>
<p>If it is unbound, then the pattern variable is bound to the data value as a
by-product of doing the match, and the match always succeeds.</p>
<p>And so pattern variables only &quot;match any value&quot; when they are unbound.  And in
matching that value, they become bound to it as a by-product of doing the
match.  Once bound to a value, a pattern variable will only match that value
(much like a literal pattern).</p>
</div>
</div>
<div class="section">
<h2><a id="tuple-patterns" name="tuple-patterns">Tuple Patterns</a></h2>
<p>Tuple patterns only match tuples.  They are written as simply a comma
seperated list of patterns within parenthesis:</p>
<pre class="literal-block">
(1, $x, &quot;buckle my shoe&quot;)
</pre>
<p>You can also write a <em>rest</em> pattern variable at the end using an asterisk
(<tt class="docutils literal"><span class="pre">*</span></tt>):</p>
<pre class="literal-block">
($a, fie, $b, *$c)
</pre>
<p>This will match the rest of the items in the data value that the tuple pattern
is matched to.  Note that the <em>rest</em> pattern variable is <em>always</em> bound to a
tuple.</p>
<p>Examples:</p>
<blockquote>
<ul class="simple">
<li>matching <tt class="docutils literal"><span class="pre">(1,</span> <span class="pre">$x,</span> <span class="pre">&quot;buckle</span> <span class="pre">my</span> <span class="pre">shoe&quot;)</span></tt> to <tt class="docutils literal"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">&quot;buckle</span> <span class="pre">my</span> <span class="pre">shoe&quot;)</span></tt>
matches, binding <tt class="docutils literal"><span class="pre">$x</span></tt> to 2.</li>
<li>matching <tt class="docutils literal"><span class="pre">(1,</span> <span class="pre">$x,</span> <span class="pre">&quot;buckle</span> <span class="pre">my</span> <span class="pre">shoe&quot;)</span></tt> to <tt class="docutils literal"><span class="pre">(1,</span> <span class="pre">2,</span> <span class="pre">&quot;buckle</span> <span class="pre">my</span> <span class="pre">belt&quot;)</span></tt>
does not match because the third pattern within the tuple pattern fails
to match the third value in the matched tuple.</li>
<li>matching <tt class="docutils literal"><span class="pre">($a,</span> <span class="pre">fie,</span> <span class="pre">$b,</span> <span class="pre">*$c)</span></tt> to <tt class="docutils literal"><span class="pre">(fee,</span> <span class="pre">fie,</span> <span class="pre">foe,</span> <span class="pre">fum)</span></tt>
matches, binding <tt class="docutils literal"><span class="pre">$a</span></tt> to <tt class="docutils literal"><span class="pre">fee</span></tt>, <tt class="docutils literal"><span class="pre">$b</span></tt> to <tt class="docutils literal"><span class="pre">foe</span></tt> and <tt class="docutils literal"><span class="pre">$c</span></tt> to
<tt class="docutils literal"><span class="pre">(fum)</span></tt>.</li>
<li>matching <tt class="docutils literal"><span class="pre">($a,</span> <span class="pre">fie,</span> <span class="pre">$b,</span> <span class="pre">*$c)</span></tt> to <tt class="docutils literal"><span class="pre">(fee,</span> <span class="pre">fie,</span> <span class="pre">foe)</span></tt>
matches, binding <tt class="docutils literal"><span class="pre">$a</span></tt> to <tt class="docutils literal"><span class="pre">fee</span></tt>, <tt class="docutils literal"><span class="pre">$b</span></tt> to <tt class="docutils literal"><span class="pre">foe</span></tt> and <tt class="docutils literal"><span class="pre">$c</span></tt> to
<tt class="docutils literal"><span class="pre">()</span></tt>.</li>
<li>matching <tt class="docutils literal"><span class="pre">($a,</span> <span class="pre">fie,</span> <span class="pre">$b,</span> <span class="pre">*$c)</span></tt> to <tt class="docutils literal"><span class="pre">(fee,</span> <span class="pre">fie)</span></tt> does not match because
the data value has to have a length of at least three.</li>
</ul>
</blockquote>
<div class="hint">
<p class="first admonition-title">Hint</p>
<p class="last">You can use <tt class="docutils literal"><span class="pre">(*$foo)</span></tt> to only match a tuple.  It will bind <tt class="docutils literal"><span class="pre">$foo</span></tt> to
the entire tuple, but will fail to match any other data type.</p>
</div>
</div>
<div class="section">
<h2><a id="matching-two-patterns-together" name="matching-two-patterns-together">Matching Two Patterns Together</a></h2>
<p>You've now seen all of the different kinds of patterns and how they are
matched to data.  Not too bad so far...</p>
<p>Patterns are used to generalize statements.  One situation where you need to
generalize a statement is when you want to ask a question.  That's been
covered above.</p>
<p>The other situation where you need to generalize a statement is when you write
<a class="reference" href="FIX">rules</a>, which are explained later.</p>
<p>But rules also need to be able to match one pattern to another <em>pattern</em>,
and not just match patterns to <em>data</em> as we have discussed so far.</p>
<p>So before we can move on to rules, we need to examine how one pattern is
matched to another pattern.</p>
<p>The short answer is that it all comes down to pattern variables and that
pattern variables may not only be bound to <em>data</em>, but may also be bound to
other <em>patterns</em>.</p>
<div class="section">
<h3><a id="binding-to-a-literal-pattern" name="binding-to-a-literal-pattern">Binding to a Literal Pattern</a></h3>
<p>Binding a pattern variable to a literal pattern is just like binding it to the
data within that literal pattern.  Nothing fancy here!</p>
</div>
<div class="section">
<h3><a id="binding-to-another-pattern-variable" name="binding-to-another-pattern-variable">Binding to Another Pattern Variable</a></h3>
<p>When pattern variable A is bound to pattern variable B, they essentially
become the <em>same pattern variable</em>.  Basically, pattern variable A <em>becomes</em>
pattern variable B (or, you might say, <em>defers</em> to pattern variable B).</p>
<p>Let's say that pattern variable A has been bound to pattern variable B and
that pattern variable B is still unbound.</p>
<ol class="arabic simple">
<li>Prior to binding pattern variable B to a value, it doesn't matter whether
you ask if pattern variable A is bound or pattern variable B is bound, the
answer is False for both.</li>
<li>It doesn't matter whether you match pattern variable A to a value or
pattern variable B to a value.  In both cases, it is pattern variable B
that gets bound to this value.</li>
<li>And once pattern variable B is bound to a value, it doesn't matter whether
you ask for the bound value of pattern variable A or pattern variable B,
you will get the same value.</li>
</ol>
<p>So for all intents and purposes pattern variable A and pattern variable B
become the same pattern variable.</p>
</div>
<div class="section">
<h3><a id="binding-to-a-tuple-pattern" name="binding-to-a-tuple-pattern">Binding to a Tuple Pattern</a></h3>
<p>Because pattern variables may be bound to tuple patterns, the term <em>fully
bound</em> is introduced.  Asking whether the pattern variable is <em>fully bound</em>
means that not only is it bound to a value (the tuple pattern), but that all
of the subordinate patterns (recursively) within the tuple pattern are also
bound to values.</p>
<p>Being <em>fully bound</em> means that the bound value of the pattern variable can be
converted into standard Python data without any pattern variables in it.  This
is important when Pyke wants to talk to Python because Python has no concept
of storing <em>variables</em> within its data structures.</p>
</div>
</div>
<div class="section">
<h2><a id="pathological-question" name="pathological-question">Pathological Question</a></h2>
<p>What is the bound value of pattern variable <tt class="docutils literal"><span class="pre">$y</span></tt> after matching the
following two tuple patterns:</p>
<blockquote>
<dl class="docutils">
<dt>Tuple pattern A:</dt>
<dd><tt class="docutils literal"><span class="pre">((ho,</span> <span class="pre">$_,</span> <span class="pre">($a,</span> <span class="pre">$a)),</span> <span class="pre">($a,</span> <span class="pre">$a,</span> <span class="pre">$b),</span> <span class="pre">($a,</span> <span class="pre">*$b))</span></tt></dd>
<dt>Tuple pattern B:</dt>
<dd><tt class="docutils literal"><span class="pre">($x,</span> <span class="pre">$x,</span> <span class="pre">$y)</span></tt></dd>
</dl>
</blockquote>
</div>
</div>

                <!-- <div id="return-to-top">
                       <a href="#">Return to Top</a>
                     </div>
                -->
            </div>
          </td>
          <td id="right-nav">
            <div id="right-nav-div">
                <h3>More:</h3>
<div class="right-item"><a href="statements.html">Statements</a><p>What is a <em>statement</em> in Pyke?</p>
</div>
<div class="right-item"><a href="pattern_matching.html">Pattern Matching</a><p>Explanation of <em>pattern matching</em> and <em>pattern variables</em>.</p>
</div>
<div class="right-item"><a href="rules/index.html">Rules</a><p>Explanation of rules, forward-chaining and backward-chaining.</p>
</div>

            </div>
          </td>
        </tr>
    </tbody>

    <tfoot id="foot">
        <tr id="foot2">
          <td id="copyright" colspan="3">
            Copyright &copy; 2007 Bruce Frederiksen
          </td>
        </tr>
    </tfoot>
  </table>

  <div id="last-modified">
    Page last modified Tue, Aug 12 2008.
  </div>

</body>
</html>
